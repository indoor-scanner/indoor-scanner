<html>
  <head>
    <title>3D render demo</title>
    <style>
      body { margin: 0; }
      canvas { width: 100%; height: 100% }
    </style>
  </head>
  <body>
    <script src="libs/socket.io.js"></script>
    <script src="libs/three.js"></script>
    <script>

      // setting up socket
      var socket = io.connect('http://localhost:8000');
      var y = 0;
      var x = 0;

      var cubes = [];
      var currentX = -9.5;
      var currentY = -9;

      var offSet = 0;

      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );
      var renderer = new THREE.WebGLRenderer();
      renderer.setSize( window.innerWidth, window.innerHeight );
      document.body.appendChild( renderer.domElement );
      camera.position.z = 15;

      var createCube = function(x) {
        var color = 0x000060 + offSet;
        var geometry = new THREE.BoxGeometry( 1, 1, 1 );
        var material = new THREE.MeshBasicMaterial({ 
          color: color,
          wireframe: true 
        });

        offSet += 0x020000;
        var cube = new THREE.Mesh( geometry, material );

        cube.translateX(x[0]);
        cube.translateY(x[1]);
        cube.translateZ(x[2]);
        cubes.push(cube);
        // increment the y value for future cubes
        if (cubes.length % 10 == 0 && cubes.length > 0) {
          currentY += 2;
        }
        scene.add(cube);
      };

      socket.on('rotatex', function (data) {
        // console.log(data);
        x = 1;
      });

      socket.on('rotatey', function (data) {
        // console.log(data);
        y = 1;
      });

      socket.on('addCube', function (pos) {
        createCube(pos);
      })

      // console.log(JSON.stringify(scene, null, 2));
      var render = function () {
        requestAnimationFrame( render );

        if (x == 1) {
          cubes.forEach(function (cube) {
            cube.rotation.x += 0.1;
          });
          x = 0;
        }

        if (y == 1) {
          cubes.forEach(function (cube) {
            cube.rotation.y += 0.1;
          });
          y = 0;
        }

        renderer.render(scene, camera);
      };

      render();
    </script>
  </body>
</html>
